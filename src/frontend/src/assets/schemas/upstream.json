{
  "oneOf": [
    {
      "required": [
        "nodes"
      ]
    },
    {
      "required": [
        "service_name",
        "discovery_type"
      ]
    }
  ],
  "type": "object",
  "properties": {
    "scheme": {
      "enum": [
        "grpc",
        "grpcs",
        "http",
        "https",
        "tcp",
        "tls",
        "udp",
        "kafka"
      ],
      "default": "http",
      "description": "The scheme of the upstream. For L7 proxy, it can be one of grpc/grpcs/http/https. For L4 proxy, it can be one of tcp/tls/udp. For specific protocols, it can be kafka."
    },
    "key": {
      "description": "the key of chash for dynamic load balancing",
      "type": "string"
    },
    "timeout": {
      "required": [
        "connect",
        "send",
        "read"
      ],
      "type": "object",
      "properties": {
        "send": {
          "exclusiveMinimum": 0,
          "type": "number"
        },
        "connect": {
          "exclusiveMinimum": 0,
          "type": "number"
        },
        "read": {
          "exclusiveMinimum": 0,
          "type": "number"
        }
      }
    },
    "discovery_type": {
      "description": "discovery type",
      "type": "string"
    },
    "discovery_args": {
      "properties": {
        "group_name": {
          "description": "group name",
          "type": "string"
        },
        "namespace_id": {
          "description": "namespace id",
          "type": "string"
        }
      },
      "type": "object"
    },
    "pass_host": {
      "enum": [
        "pass",
        "node",
        "rewrite"
      ],
      "default": "pass",
      "description": "mod of host passing",
      "type": "string"
    },
    "upstream_host": {
      "pattern": "^\\*?[0-9a-zA-Z-._\\[\\]:]+$",
      "type": "string"
    },
    "service_name": {
      "minLength": 1,
      "maxLength": 256,
      "type": "string"
    },
    "id": {
      "anyOf": [
        {
          "minLength": 1,
          "maxLength": 64,
          "pattern": "^[a-zA-Z0-9-_.]+$",
          "type": "string"
        },
        {
          "minimum": 1,
          "type": "integer"
        }
      ]
    },
    "type": {
      "default": "roundrobin",
      "description": "algorithms of load balancing",
      "type": "string"
    },
    "name": {
      "minLength": 1,
      "maxLength": 100,
      "type": "string"
    },
    "create_time": {
      "type": "integer"
    },
    "tls": {
      "dependencies": {
        "client_key": {
          "not": {
            "required": [
              "client_cert_id"
            ]
          },
          "required": [
            "client_cert"
          ]
        },
        "client_cert_id": {
          "not": {
            "required": [
              "client_client",
              "client_key"
            ]
          }
        },
        "client_cert": {
          "not": {
            "required": [
              "client_cert_id"
            ]
          },
          "required": [
            "client_key"
          ]
        }
      },
      "type": "object",
      "properties": {
        "client_key": {
          "minLength": 128,
          "maxLength": 65536,
          "type": "string"
        },
        "client_cert_id": {
          "anyOf": [
            {
              "minLength": 1,
              "maxLength": 64,
              "pattern": "^[a-zA-Z0-9-_.]+$",
              "type": "string"
            },
            {
              "minimum": 1,
              "type": "integer"
            }
          ]
        },
        "verify": {
          "default": false,
          "description": "Turn on server certificate verification, currently only kafka upstream is supported",
          "type": "boolean"
        },
        "client_cert": {
          "minLength": 128,
          "maxLength": 65536,
          "type": "string"
        }
      }
    },
    "retry_timeout": {
      "minimum": 0,
      "type": "number"
    },
    "desc": {
      "maxLength": 256,
      "type": "string"
    },
    "checks": {
      "anyOf": [
        {
          "required": [
            "active"
          ]
        },
        {
          "required": [
            "active",
            "passive"
          ]
        }
      ],
      "type": "object",
      "properties": {
        "passive": {
          "properties": {
            "healthy": {
              "properties": {
                "successes": {
                  "default": 5,
                  "minimum": 0,
                  "maximum": 254,
                  "type": "integer"
                },
                "http_statuses": {
                  "default": [
                    200,
                    201,
                    202,
                    203,
                    204,
                    205,
                    206,
                    207,
                    208,
                    226,
                    300,
                    301,
                    302,
                    303,
                    304,
                    305,
                    306,
                    307,
                    308
                  ],
                  "uniqueItems": true,
                  "items": {
                    "minimum": 200,
                    "maximum": 599,
                    "type": "integer"
                  },
                  "minItems": 1,
                  "type": "array"
                }
              },
              "type": "object"
            },
            "unhealthy": {
              "properties": {
                "tcp_failures": {
                  "default": 2,
                  "minimum": 0,
                  "maximum": 254,
                  "type": "integer"
                },
                "timeouts": {
                  "default": 7,
                  "minimum": 0,
                  "maximum": 254,
                  "type": "integer"
                },
                "http_failures": {
                  "default": 5,
                  "minimum": 0,
                  "maximum": 254,
                  "type": "integer"
                },
                "http_statuses": {
                  "default": [
                    429,
                    500,
                    503
                  ],
                  "uniqueItems": true,
                  "items": {
                    "minimum": 200,
                    "maximum": 599,
                    "type": "integer"
                  },
                  "minItems": 1,
                  "type": "array"
                }
              },
              "type": "object"
            },
            "type": {
              "enum": [
                "http",
                "https",
                "tcp"
              ],
              "default": "http",
              "type": "string"
            }
          },
          "type": "object"
        },
        "active": {
          "properties": {
            "concurrency": {
              "default": 10,
              "type": "integer"
            },
            "healthy": {
              "properties": {
                "successes": {
                  "default": 2,
                  "minimum": 1,
                  "maximum": 254,
                  "type": "integer"
                },
                "interval": {
                  "minimum": 1,
                  "default": 1,
                  "type": "integer"
                },
                "http_statuses": {
                  "default": [
                    200,
                    302
                  ],
                  "uniqueItems": true,
                  "items": {
                    "minimum": 200,
                    "maximum": 599,
                    "type": "integer"
                  },
                  "minItems": 1,
                  "type": "array"
                }
              },
              "type": "object"
            },
            "https_verify_certificate": {
              "default": true,
              "type": "boolean"
            },
            "host": {
              "pattern": "^\\*?[0-9a-zA-Z-._\\[\\]:]+$",
              "type": "string"
            },
            "timeout": {
              "default": 1,
              "type": "number"
            },
            "unhealthy": {
              "properties": {
                "tcp_failures": {
                  "default": 2,
                  "minimum": 1,
                  "maximum": 254,
                  "type": "integer"
                },
                "timeouts": {
                  "default": 3,
                  "minimum": 1,
                  "maximum": 254,
                  "type": "integer"
                },
                "interval": {
                  "minimum": 1,
                  "default": 1,
                  "type": "integer"
                },
                "http_statuses": {
                  "default": [
                    429,
                    404,
                    500,
                    501,
                    502,
                    503,
                    504,
                    505
                  ],
                  "uniqueItems": true,
                  "items": {
                    "minimum": 200,
                    "maximum": 599,
                    "type": "integer"
                  },
                  "minItems": 1,
                  "type": "array"
                },
                "http_failures": {
                  "default": 5,
                  "minimum": 1,
                  "maximum": 254,
                  "type": "integer"
                }
              },
              "type": "object"
            },
            "req_headers": {
              "minItems": 1,
              "items": {
                "type": "string"
              },
              "uniqueItems": true,
              "type": "array"
            },
            "port": {
              "minimum": 1,
              "maximum": 65535,
              "type": "integer"
            },
            "type": {
              "enum": [
                "http",
                "https",
                "tcp"
              ],
              "default": "http",
              "type": "string"
            },
            "http_path": {
              "default": "/",
              "type": "string"
            }
          },
          "type": "object"
        }
      }
    },
    "labels": {
      "patternProperties": {
        ".*": {
          "minLength": 1,
          "maxLength": 64,
          "pattern": "^\\S+$",
          "type": "string",
          "description": "value of label"
        }
      },
      "description": "key/value pairs to specify attributes",
      "type": "object"
    },
    "retries": {
      "minimum": 0,
      "type": "integer"
    },
    "update_time": {
      "type": "integer"
    },
    "nodes": {
      "anyOf": [
        {
          "patternProperties": {
            ".*": {
              "minimum": 0,
              "description": "weight of node",
              "type": "integer"
            }
          },
          "type": "object"
        },
        {
          "items": {
            "required": [
              "host",
              "port",
              "weight"
            ],
            "type": "object",
            "properties": {
              "priority": {
                "default": 0,
                "description": "priority of node",
                "type": "integer"
              },
              "weight": {
                "minimum": 0,
                "description": "weight of node",
                "type": "integer"
              },
              "port": {
                "minimum": 1,
                "description": "port of node",
                "type": "integer"
              },
              "host": {
                "pattern": "^\\*?[0-9a-zA-Z-._\\[\\]:]+$",
                "type": "string"
              },
              "metadata": {
                "description": "metadata of node",
                "type": "object"
              }
            }
          },
          "type": "array"
        }
      ]
    },
    "keepalive_pool": {
      "properties": {
        "requests": {
          "default": 1000,
          "minimum": 1,
          "type": "integer"
        },
        "size": {
          "default": 320,
          "minimum": 1,
          "type": "integer"
        },
        "idle_timeout": {
          "default": 60,
          "minimum": 0,
          "type": "number"
        }
      },
      "type": "object"
    },
    "hash_on": {
      "enum": [
        "vars",
        "header",
        "cookie",
        "consumer",
        "vars_combinations"
      ],
      "default": "vars",
      "type": "string"
    }
  }
}
