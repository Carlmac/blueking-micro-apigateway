meta {
  name: create_route
  type: http
  seq: 6
}

post {
  url: {{scheme}}://{{host}}/api/v1/open/gateways/{{gateway_name}}/resources/routes/
}

headers {
  Content-Type: application/json
  X-BK-API-TOKEN: {{x_bk_api_token}}
}

body {
    [
        {
          "name": "test_route",
          "config": {
            "uri": "/index.html",
            "hosts": [
              "foo.com",
              "*.bar.com"
            ],
            "remote_addrs": [
              "127.0.0.0/8"
            ],
            "methods": [
              "PUT",
              "GET"
            ],
            "enable_websocket": true,
            "upstream": {
              "type": "roundrobin",
              "nodes": {
                "127.0.0.1:1980": 1
              }
            }
          }
        }
    ]
}

script:post-response {
    bru.setVar("route_id", res.body.data[0].id);
}

assert {
  res.status: eq 200
  res.body.data[0].name: eq "test_route"
  res.body.data[0].id: matches /^bk.*/
}